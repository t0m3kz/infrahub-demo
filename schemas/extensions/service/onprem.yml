---
version: "1.0"

generics:
  - name: Generic
    namespace: Managed
    description: "Base for on-premises infrastructure services and resources"
    label: "On-Premises Resource"
    icon: "mdi:server-network"
    include_in_menu: false
    order_by:
      - name__value
    display_label: "{{name__value}}"
    attributes:
      - name: name
        kind: Text
        label: Name
        optional: false
        order_weight: 1
        description: "Resource name"
      - name: description
        kind: Text
        label: Description
        optional: true
        order_weight: 2
        description: "Resource description"
      - name: status
        order_weight: 30
        optional: false
        kind: Dropdown
        choices:
          - name: provisioning
            label: Provisioning
            description: "In the process of being set up and configured."
            color: "#ffff7f"
          - name: active
            label: Active
            description: "Fully operational and currently in service."
            color: "#7fbf7f"
          - name: decommissioning
            label: Decommissioning
            description: "In the process of being taken out of service."
            color: "#fbfbfb"
          - name: decommissioned
            label: Decommissioned
            description: "Taken out of service."
            color: "#bfbfbf"
        default_value: provisioning
    relationships:
      - name: deployment
        peer: TopologyDeployment
        cardinality: one
        kind: Attribute
        order_weight: 110
        optional: false
        on_delete: no-action
        description: "The deployment location for this resource"
      # Default: single interface for all services/protocols (BGP, OSPF, etc.)
      - name: interface
        peer: DcimInterface
        cardinality: one
        optional: true
        identifier: interface_services
        description: "Primary interface for this service or protocol"

  - name: GenericDevice
    namespace: Managed
    description: "On-premises resources attached to physical devices"
    label: "Device-based Resource"
    include_in_menu: false
    relationships:
      - name: device
        peer: DcimDevice
        optional: true
        cardinality: one
        kind: Generic
        direction: inbound
        identifier: device_services
        order_weight: 1000

  # Use this generic ONLY for segments (VLAN, VXLAN, VRF, etc.)
  # Only inherit this for segment-like resources (VLAN, VXLAN, VRF, etc.)
  - name: GenericInterfaces
    namespace: Managed
    description: "On-premises segment attached to multiple device interfaces"
    label: "Segment Resource (Many Interfaces)"
    include_in_menu: false
    relationships:
      - name: interfaces
        peer: DcimInterface
        label: Assigned Interfaces
        cardinality: many
        kind: Generic
        optional: true
        identifier: interface_services

extensions:
  nodes:
    - kind: DcimDevice
      relationships:
        - name: device_services
          peer: ManagedGeneric
          label: Device capabilities
          optional: true
          cardinality: many
          direction: outbound
          kind: Generic
          on_delete: no-action
          identifier: device_services
    - kind: DcimInterface
      relationships:
        - name: interface_services
          peer: ManagedGeneric
          label: Interface capabilities
          identifier: interface_services
          optional: true
          cardinality: many
          kind: Generic
          on_delete: no-action

        # Network segment membership (trunk or access)
        - name: network_segments
          peer: ManagedNetworkSegment
          label: Network Segments
          optional: true
          cardinality: many
          kind: Generic
          identifier: interface_segments
          order_weight: 3100
