---
version: "1.0"

nodes:
  - name: Element
    namespace: Topology
    description: "Physical aspect of topology elements."
    label: "Network Elements"
    icon: "carbon:network-3-reference"
    menu_placement: "DesignTopology"
    human_friendly_id:
      - quantity__value
      - role__value
      - template__template_name__value
    order_by: [role__value, quantity__value, template__template_name__value]
    display_label: >
      {{quantity__value}} x {{role__value|upper}}
      {{template__template_name__value}}
    uniqueness_constraints:
      - ["template", "quantity__value", "role__value"]
    attributes:
      - name: quantity
        kind: Number
        order_weight: 1200
      - name: role
        kind: Dropdown
        optional: true
        order_weight: 1000
        choices:
          - name: core
            label: Core Router
            description: Central part of the network.
            color: "#7f7fff"
          - name: edge
            label: Edge Router
            description: Network boundary with external networks.
            color: "#bf7fbf"
          - name: cpe
            label: Customer Premise Equipment
            description: >
              Devices located at the customer's premises.
            color: "#bf7f7f"
          - name: leaf
            label: Leaf Switch
            description: Leaf Switch part of a Pod.
            color: "#e6e6fa"
          - name: tor
            label: ToR/Level2 Switch
            description: Top of Rack  or Lavel2 leaf part of a Pod.
            color: "#e6e6fa"
          - name: border-leaf
            label: Border Leaf Switch
            description: Border Leaf providing external connectivity in a Pod.
            color: "#dda0dd"
          - name: firewall
            label: Firewall
            description: "Security boundary with external network"
            color: "#6e5abd"
          - name: load-balancer
            label: Load Balancer
            description: Load Balancer part of a Fabric.
            color: "#38e7fb"
          - name: oob
            label: OOB Switch
            description: Out of Band Switch part of a Fabric.
            color: "#e3e7fd"
          - name: console
            label: Console Server
            description: Console Server part of a Fabric.
            color: "#e9ebfd"
    relationships:
      - name: template
        label: Device Template
        peer: CoreObjectTemplate
        optional: false
        cardinality: one
        kind: Attribute
        order_weight: 1500

  - name: DataCenter
    namespace: Topology
    inherit_from:
      - CoreArtifactTarget
      - TopologyDeployment
      - TopologyPhysicalDeployment
      - GeneratorTarget
      - TopologyDeviceHosting
    label: Data Center
    include_in_menu: true
    children: TopologyPod
    uniqueness_constraints:
      - ["name__value", "index__value"]
    human_friendly_id:
      - name__value
      - index__value
    display_label: "{{ name__value}} - Fabric {{index__value}}"
    attributes:
      - name: index
        kind: Number
        order_weight: 110
      - name: status
        kind: Dropdown
        label: Status
        optional: false
        default_value: provisioning
        order_weight: 550
        choices:
          - name: active
            label: Active
            description: "Operational and in service."
            color: "#7FBF7F"
          - name: provisioning
            label: Provisioning
            description: "Being built or staged."
            color: "#FFFF7F"
          - name: maintenance
            label: Maintenance
            description: "Temporarily under maintenance."
            color: "#FFD27F"
          - name: decommissioned
            label: Decommissioned
            description: "Removed from active service."
            color: "#BFBFBF"
      - name: fully_managed
        label: Fully Managed
        kind: Boolean
        optional: false
        default_value: true
        order_weight: 600
      - name: amount_of_super_spines
        label: Amount of Super Spine switches
        kind: Number
        optional: false
        default_value: 2
        order_weight: 1000
        parameters:
          min_value: 1
          max_value: 4
      - name: fabric_interface_sorting_method
        kind: Dropdown
        label: Fabric interface assignment
        choices:
          - name: bottom_up
            label: Bottom Up
            description: Assign interfaces bottom-up.
            color: "#869FB3"
          - name: top_down
            label: Top Down
            description: Assign interfaces top-down.
            color: "#004E64"
        default_value: bottom_up
        order_weight: 1200
      - name: spine_interface_sorting_method
        kind: Dropdown
        label: Spine interface assignment
        choices:
          - name: bottom_up
            label: Bottom Up
            description: Assign interfaces bottom-up.
            color: "#869FB3"
          - name: top_down
            label: Top Down
            description: Assign interfaces top-down.
            color: "#004E64"
        default_value: bottom_up
        order_weight: 1300
    relationships:
      - name: site_layout
        label: "Site Layout"
        description: "Physical floor plan layout for this data center"
        peer: TopologySiteLayout
        kind: Attribute
        cardinality: one
        optional: true
        identifier: "dc__site_layout"
        order_weight: 900
        on_delete: no-action
      - name: design
        label: "Data Center Design"
        description: "Logical network topology design for this data center"
        peer: TopologyDataCenterDesign
        kind: Attribute
        cardinality: one
        optional: true
        identifier: "dc__design"
        order_weight: 950
        on_delete: no-action
      - name: super_spine_template
        peer: TemplateDcimPhysicalDevice
        kind: Attribute
        cardinality: one
        identifier: "fabric__super_spine_template"
        order_weight: 1100
        on_delete: no-action

  - name: Pod
    namespace: Topology
    inherit_from:
      - TopologyDeployment
      - GeneratorTarget
      - TopologyRackHosting
      - TopologyDeviceHosting
    parent: TopologyDataCenter
    children: ""
    label: Pod
    human_friendly_id:
      - parent__name__value
      - parent__index__value
      - index__value
    display_label: "{{ name__value }}"
    uniqueness_constraints:
      - ["name__value", "index__value"]
    include_in_menu: false
    attributes:
      - name: index
        kind: Number
        order_weight: 110
      - name: status
        kind: Dropdown
        label: Status
        optional: false
        default_value: provisioning
        order_weight: 140
        choices:
          - name: active
            label: Active
            description: "Operational and in service."
            color: "#7FBF7F"
          - name: provisioning
            label: Provisioning
            description: "Being built or staged."
            color: "#FFFF7F"
          - name: maintenance
            label: Maintenance
            description: "Temporarily under maintenance."
            color: "#FFD27F"
          - name: decommissioned
            label: Decommissioned
            description: "Removed from active service."
            color: "#BFBFBF"
      - name: name
        kind: Text
        computed_attribute:
          kind: Jinja2
          jinja2_template: >
            {{parent__name__value|upper}}-{{parent__index__value}}-POD-{{
            index__value }}
        read_only: true
        optional: false
      - name: amount_of_spines
        label: Amount of Spine switches
        kind: Number
        optional: true
        default_value: 4
        order_weight: 1000
        parameters:
          min_value: 1
          max_value: 4
      - name: deployment_type
        kind: Dropdown
        optional: true
        order_weight: 150
        choices:
          - name: middle_rack
            label: Middle Rack
            description: Middle Rack deployment
            color: "#7f7fff"
          - name: tor
            label: Top of Rack
            description: Top of Rack deployment
            color: "#bf7fbf"
          - name: mixed
            label: ToR and Middle Rack
            description: Mix of ToR and Middle Rack deployment
            color: "#bf7f7f"
        default_value: tor
      - name: leaf_interface_sorting_method
        kind: Dropdown
        choices:
          - name: bottom_up
            color: "#869FB3"
            description: Assign interfaces bottom-up.
          - name: top_down
            color: "#004E64"
            description: Assign interfaces top-down.
        default_value: bottom_up
        order_weight: 3000
      - name: spine_interface_sorting_method
        kind: Dropdown
        choices:
          - name: bottom_up
            color: "#869FB3"
            description: Assign interfaces bottom-up.
          - name: top_down
            color: "#004E64"
            description: Assign interfaces top-down.
        default_value: bottom_up
        order_weight: 4000
      - name: usage
        kind: Text
        read_only: true
        optional: true
    relationships:
      - name: site_layout
        label: "Site Layout"
        description: "Physical floor plan layout for this pod"
        peer: TopologySiteLayout
        kind: Attribute
        cardinality: one
        optional: true
        identifier: "pod__site_layout"
        order_weight: 900
        on_delete: no-action
      - name: design
        label: "Pod Design"
        description: "Logical network topology design for this pod"
        peer: TopologyPodDesign
        kind: Attribute
        cardinality: one
        optional: true
        identifier: "pod__design"
        order_weight: 950
        on_delete: no-action
      - name: spine_template
        peer: TemplateDcimPhysicalDevice
        kind: Attribute
        cardinality: one
        optional: false
        identifier: "pod__spine_template"
        order_weight: 1100
        on_delete: no-action
      - name: loopback_pool
        peer: CoreIPAddressPool
        kind: Attribute
        cardinality: one
        optional: true
        identifier: "pod__loopback_pool"
        order_weight: 6000
        on_delete: cascade
      - name: prefix_pool
        peer: CoreIPPrefixPool
        kind: Attribute
        cardinality: one
        optional: true
        identifier: "pod__prefix_pool"
        order_weight: 7000
        on_delete: cascade
