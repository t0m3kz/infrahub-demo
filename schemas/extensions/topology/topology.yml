---
version: "1.0"
generics:
  - name: ManagementServer
    namespace: Network
    description: "Generic for network management server (dns, ntp, and dhcp)."
    label: "Network Management Servers"
    human_friendly_id:
      - name__value
    display_label: "{{name__value}}"
    order_by: [name__value]
    include_in_menu: false
    attributes:
      - name: name
        kind: Text
      - name: description
        kind: Text
        optional: true
      - name: status
        kind: Dropdown
        choices:
          - name: active
            label: Active
            description: "Fully operational and currently in service."
            color: "#7fbf7f"
          - name: provisioning
            label: Provisioning
            description: "In the process of being set up and configured."
            color: "#ffff7f"
          - name: maintenance
            label: Maintenance
            description: "Undergoing routine maintenance or repairs."
            color: "#ffd27f"
          - name: drained
            label: Drained
            description: "Temporarily taken out of service."
            color: "#bfbfbf"
    relationships:
      - name: location
        peer: LocationGeneric
        optional: true
        cardinality: many
      - name: ip_addresses
        peer: IpamIPAddress
        optional: true
        cardinality: many
        kind: Component

  - name: Deployment
    namespace: Topology
    include_in_menu: false
    hierarchical: true
    attributes:
      - name: name
        kind: Text
        order_weight: 100
      - name: index
        kind: Number
        order_weight: 110
    relationships:
      - name: devices
        peer: DcimGenericDevice
        kind: Component
        cardinality: many
        identifier: "fabric__devices"
        order_weight: 7000
  - name: Design
    namespace: Topology
    description: "Design aspect of topology elements."
    label: "Topology Design"
    include_in_menu: false
    human_friendly_id:
      - name__value
    display_label: "{{name__value}}"
    attributes:
      - name: name
        kind: Text
        unique: true
        order_weight: 100
      - name: naming_convention
        order_weight: 500
        label: "Naming Convention"
        kind: Dropdown
        choices:
          - name: standard
            label: Standard
          - name: hierarchical
            label: Hierarchical
          - name: flat
            label: Flat

nodes:
  # --------------------  Elements  --------------------
  - name: DataCenterDesign
    namespace: Topology
    description: "Design aspect of topology elements."
    label: "Topology Design"
    inherit_from:
      - TopologyDesign
    attributes:
      - name: deployment_type
        kind: Dropdown
        optional: false
        order_weight: 150
        choices:
          - name: middle_rack
            label: Middle Rack
            description: Middle Rack deployment
            color: "#7f7fff"
          - name: tor
            label: Top of Rack
            description: Top of Rack deployment
            color: "#bf7fbf"
          - name: mixed
            label: ToR and Middle Rack
            description: Mix of ToR and Middle Rack deployment
            color: "#bf7f7f"
        default_value: tor
      - name: maximum_super_spines
        order_weight: 200
        label: "Maximum Super Spines"
        kind: Number
        default_value: 2
        optional: false
        parameters:
          min_value: 1
          max_value: 4
      - name: maximum_pods
        order_weight: 300
        label: "Maximum Pods"
        kind: Number
        default_value: 2
        optional: false
      - name: maximum_spines
        order_weight: 350
        label: "Maximum Spine Switches per Pod"
        kind: Number
        default_value: 2
        optional: false
        parameters:
          min_value: 2
          max_value: 4
      - name: maximum_leafs
        order_weight: 400
        label: "Maximum Leaf Switches per Pod"
        kind: Number
        default_value: 16
        optional: false
      - name: maximum_middle_racks
        order_weight: 420
        label: "Maximum Middle Racks per Pod"
        kind: Number
        default_value: 2
        optional: false
      - name: maximum_rack_leafs
        order_weight: 450
        label: "Maximum Leaf Switches per Rack"
        kind: Number
        default_value: 4
        optional: false
      - name: maximum_tors
        order_weight: 460
        label: "Maximum ToR Switches."
        kind: Number
        default_value: 16
        optional: false
    relationships:
      - name: deployments
        peer: TopologyDataCenter
        kind: Generic
        cardinality: many
        identifier: "dc__deployments"
        order_weight: 5000

  - name: Element
    namespace: Topology
    description: "Physical aspect of topology elements."
    label: "Topology Element"
    icon: "carbon:network-3-reference"
    menu_placement: "DesignTopology"
    human_friendly_id:
      - name__value
    order_by: [name__value]
    display_label: "{{name__value}}"
    # workaround for loading data
    # default_filter: name__value
    attributes:
      - name: name
        kind: Text
        order_weight: 1000
      - name: description
        kind: Text
        order_weight: 1100
        optional: true
      - name: quantity
        kind: Number
        order_weight: 1200
      - name: role
        kind: Dropdown
        optional: true
        order_weight: 1400
        choices:
          - name: core
            label: Core Router
            description: Central part of the network.
            color: "#7f7fff"
          - name: edge
            label: Edge Router
            description: Network boundary with external networks.
            color: "#bf7fbf"
          - name: cpe
            label: Customer Premise Equipment
            description: Devices located at the customer's premises.
            color: "#bf7f7f"
          - name: leaf
            label: Leaf Switch
            description: Leaf Switch part of a Pod.
            color: "#e6e6fa"
          - name: tor
            label: ToR/Level2 Switch
            description: Top of Rack  or Lavel2 leaf part of a Pod.
            color: "#e6e6fa"
          - name: border-leaf
            label: Border Leaf Switch
            description: Border Leaf providing external connectivity in a Pod.
            color: "#dda0dd"
          - name: firewall
            label: Firewall
            description: "Security boundary with external network"
            color: "#6e5abd"
          - name: load-balancer
            label: Load Balancer
            description: Load Balancer part of a Fabric.
            color: "#38e7fb"
          - name: oob
            label: OOB Switch
            description: Out of Band Switch part of a Fabric.
            color: "#e3e7fd"
          - name: console
            label: Console Server
            description: Console Server part of a Fabric.
            color: "#e9ebfd"
    relationships:
      - name: deployment
        peer: LocationRack
        optional: true
        cardinality: many
      - name: device_type
        label: Type
        peer: DcimDeviceType
        optional: false
        cardinality: one
        kind: Attribute
        order_weight: 1400
      - name: template
        label: Device Template
        peer: CoreObjectTemplate
        optional: false
        cardinality: one
        kind: Attribute
        order_weight: 1500

  - name: DataCenter
    namespace: Topology
    inherit_from:
      - CoreArtifactTarget
      - TopologyDeployment
    include_in_menu: true
    children: TopologyPod
    uniqueness_constraints:
      - ["name__value", "index__value"]
    human_friendly_id:
      - name__value
      - index__value
    display_label: "{{ name__value}} - Fabric {{index__value}}"
    attributes:
      - name: fully_managed
        label: Fully Managed
        kind: Boolean
        optional: false
        default_value: true
        order_weight: 600
      - name: strategy
        kind: Dropdown
        label: Strategy
        optional: false
        order_weight: 650
        choices:
          - name: ospf-ibgp
            label: ospf-ibgp
            color: "#aedcee"
          - name: ebgp-ibgp
            label: ebgp-ibgp
            color: "#7f7fff"
        default_value: ebgp-ibgp
      - name: underlay
        label: IPV6 underlay
        kind: Boolean
        optional: false
        default_value: false
        order_weight: 660
      - name: amount_of_super_spines
        label: Amount of Super Spine switches
        kind: Number
        optional: false
        default_value: 2
        order_weight: 1000
        parameters:
          min_value: 1
          max_value: 4
      - name: fabric_interface_sorting_method
        kind: Dropdown
        label: Fabric interface assignment
        choices:
          - name: bottom_up
            label: Bottom Up
            description: Assign interfaces bottom-up.
            color: "#869FB3"
          - name: top_down
            label: Top Down
            description: Assign interfaces top-down.
            color: "#004E64"
        default_value: bottom_up
        order_weight: 1200
      - name: spine_interface_sorting_method
        kind: Dropdown
        label: Spine interface assignment
        choices:
          - name: bottom_up
            label: Bottom Up
            description: Assign interfaces bottom-up.
            color: "#869FB3"
          - name: top_down
            label: Top Down
            description: Assign interfaces top-down.
            color: "#004E64"
        default_value: bottom_up
        order_weight: 1300
    relationships:
      - name: design_pattern
        peer: TopologyDataCenterDesign
        kind: Generic
        cardinality: one
        identifier: "dc__design_pattern"
        order_weight: 500
      - name: super_spine_template
        peer: TemplateDcimPhysicalDevice
        kind: Attribute
        cardinality: one
        identifier: "fabric__super_spine_template"
        order_weight: 1100

  - name: Pod
    namespace: Topology
    inherit_from:
      - TopologyDeployment
      - GeneratorTarget
    parent: TopologyDataCenter
    children: ""
    human_friendly_id:
      - parent__name__value
      - parent__index__value
      - index__value
    display_label: "{{parent__name__value}}-Fabric-{{parent__index__value}}-POD-{{index__value}}"  # yamllint disable-line rule:line-length
    uniqueness_constraints:
      - ["parent", "index__value"]
    include_in_menu: false
    attributes:
      - name: name
        kind: Text
        computed_attribute:
          kind: Jinja2
          jinja2_template: "{{parent__name__value|upper}}-{{parent__index__value}}-POD-{{ index__value }}"  # yamllint disable-line rule:line-length
        read_only: true
        optional: false
      - name: amount_of_spines
        label: Amount of Spine switches
        kind: Number
        optional: false
        default_value: 4
        order_weight: 1000
        parameters:
          min_value: 1
          max_value: 4
      - name: role
        kind: Dropdown
        default_value: cpu
        choices:
          - name: fabric
            label: Fabric
          - name: cpu
            label: CPU
          - name: gpu
            label: GPU
          - name: storage
            label: Storage
        optional: false
        order_weight: 2000
      - name: leaf_interface_sorting_method
        kind: Dropdown
        choices:
          - name: bottom_up
            color: "#869FB3"
            description: Assign interfaces bottom-up.
          - name: top_down
            color: "#004E64"
            description: Assign interfaces top-down.
        default_value: bottom_up
        order_weight: 3000
      - name: spine_interface_sorting_method
        kind: Dropdown
        choices:
          - name: bottom_up
            color: "#869FB3"
            description: Assign interfaces bottom-up.
          - name: top_down
            color: "#004E64"
            description: Assign interfaces top-down.
        default_value: bottom_up
        order_weight: 4000
    relationships:
      - name: spine_template
        peer: TemplateDcimPhysicalDevice
        kind: Attribute
        cardinality: one
        identifier: "pod__spine_template"
        order_weight: 1100
      - name: racks
        peer: LocationRack
        kind: Generic
        cardinality: many
        identifier: "rack__pod"
        order_weight: 1200
        on_delete: cascade
      - name: loopback_pool
        peer: CoreIPAddressPool
        kind: Attribute
        cardinality: one
        optional: true
        branch: agnostic
        identifier: "pod__loopback_pool"
        order_weight: 6000
        on_delete: cascade
      - name: prefix_pool
        peer: CoreIPPrefixPool
        kind: Attribute
        cardinality: one
        branch: agnostic
        optional: true
        identifier: "pod__prefix_pool"
        order_weight: 7000
        on_delete: cascade

extensions:
  nodes:
    - kind: DcimGenericDevice
      relationships:
        - name: deployment
          peer: TopologyDeployment
          cardinality: one
          identifier: "fabric__devices"
