# yaml-language-server: $schema=https://schema.infrahub.app/infrahub/schema/latest.json
---
version: "1.0"
generics:
  - name: ManagementServer
    namespace: Network
    description: "Generic model for network management server (dns, ntp, and dhcp)."
    label: "Network Management Servers"
    human_friendly_id:
      - name__value
    display_labels: [name__value]
    order_by: [name__value]
    include_in_menu: false
    attributes:
      - name: name
        kind: Text
      - name: description
        kind: Text
        optional: true
      - name: status
        kind: Dropdown
        choices:
          - name: active
            label: Active
            description: "Fully operational and currently in service."
            color: "#7fbf7f"
          - name: provisioning
            label: Provisioning
            description: "In the process of being set up and configured."
            color: "#ffff7f"
          - name: maintenance
            label: Maintenance
            description: "Undergoing routine maintenance or repairs."
            color: "#ffd27f"
          - name: drained
            label: Drained
            description: "Temporarily taken out of service."
            color: "#bfbfbf"
    relationships:
      - name: location
        peer: LocationGeneric
        optional: true
        cardinality: many
      - name: ip_addresses
        peer: IpamIPAddress
        optional: true
        cardinality: many
        kind: Component

  - name: Deployment
    namespace: Topology
    display_labels: ["name__value"]
    include_in_menu: false
    hierarchical: true
    attributes:
      - name: name
        kind: Text
        unique: true
        branch: aware
        order_weight: 100
      - name: index
        kind: Number
        branch: agnostic
        order_weight: 110
    relationships:
      - name: devices
        branch: aware
        peer: DcimGenericDevice
        kind: Component
        cardinality: many
        identifier: "fabric__devices"
        order_weight: 7000
nodes:
  # --------------------  Elements  --------------------
  - name: Element
    namespace: Topology
    description: "Physical aspect of topology elements."
    label: "Topology Element"
    icon: "carbon:network-3-reference"
    menu_placement: "DesignTopology"
    human_friendly_id:
      - name__value
    order_by: [name__value]
    display_labels:
      - name__value
    uniqueness_constraints:
      - [name__value]
    default_filter: name__value
    attributes:
      - name: name
        kind: Text
        order_weight: 1000
      - name: description
        kind: Text
        order_weight: 1100
        optional: true
      - name: quantity
        kind: Number
        order_weight: 1200
      - name: role
        kind: Dropdown
        optional: true
        order_weight: 1400
        choices:
          - name: core
            label: Core Router
            description: Central part of the network.
            color: "#7f7fff"
          - name: edge
            label: Edge Router
            description: Network boundary with external networks.
            color: "#bf7fbf"
          - name: cpe
            label: Customer Premise Equipment
            description: Devices located at the customer's premises.
            color: "#bf7f7f"
          - name: leaf
            label: Leaf Switch
            description: Top of Rack part of a Pod.
            color: "#e6e6fa"
          - name: border_leaf
            label: Border Leaf Switch
            description: Border Leaf providing external connectivity in a Pod.
            color: "#dda0dd"
          - name: dc_firewall
            label: DC Firewall
            description: "Security boundary with external network"
            color: "#6e5abd"
          - name: edge_firewall
            label: Edge Firewall
            description: "Security boundary with external network"
            color: "#6a5acd"
          - name: branch_firewall
            label: Branch Firewall
            description: "Security boundary with external network"
            color: "#6a5bdd"
          - name: load_balancer
            label: Load Balancer
            description: Load Balancer part of a Fabric.
            color: "#38e7fb"
          - name: oob
            label: OOB Switch
            description: Out of Band Switch part of a Fabric.
            color: "#e3e7fd"
          - name: console
            label: Console Server
            description: Console Server part of a Fabric.
            color: "#e9ebfd"
    relationships:
      - name: device_type
        label: Type
        peer: DcimDeviceType
        optional: false
        cardinality: one
        kind: Attribute
        order_weight: 1400
      - name: template
        label: Device Template
        peer: CoreObjectTemplate
        optional: false
        cardinality: one
        kind: Attribute
        order_weight: 1500

  - name: DataCenter
    namespace: Topology
    branch: agnostic
    inherit_from:
      - CoreArtifactTarget
      - TopologyDeployment
    include_in_menu: true
    children: TopologyPod
    parent: ""
    attributes:
      - name: size
        label: Data Center Size
        kind: Dropdown
        branch: aware
        choices:
          - name: S
            label: Small
            description: Small data center with limited capacity.
            color: "#869FB3"
          - name: M
            label: Medium
            description: Medium-sized data center with moderate capacity.
            color: "#004E64"
          - name: L
            label: Large
            description: Large data center with high capacity.
            color: "#003147"
          - name: XL
            label: Extra Large
            description: Extra large data center with extensive capacity.
            color: "#001F2D"
        optional: false
        default_value: M
        order_weight: 500
      - name: fully_managed
        label: Fully Managed
        kind: Boolean
        optional: false
        default_value: true
        order_weight: 600
      - name: amount_of_super_spines
        label: Amount of Super Spine switches
        kind: Number
        optional: false
        default_value: 4
        branch: aware
        order_weight: 1000

      - name: fabric_interface_sorting_method
        kind: Dropdown
        branch: aware
        label: Fabric interface assignment
        choices:
          - name: bottom_up
            label: Bottom Up
            description: Assign interfaces starting from the lowest numbered interface.
            color: "#869FB3"
          - name: top_down
            label: Top Down
            description: Assign interfaces starting from the highest numbered interface.
            color: "#004E64"
        default_value: bottom_up
        order_weight: 1200
      - name: spine_interface_sorting_method
        kind: Dropdown
        branch: aware
        label: Spine interface assignment
        choices:
          - name: bottom_up
            label: Bottom Up
            description: Assign interfaces starting from the lowest numbered interface.
            color: "#869FB3"
          - name: top_down
            label: Top Down
            description: Assign interfaces starting from the highest numbered interface.
            color: "#004E64"
        default_value: bottom_up
        order_weight: 1300
    relationships:
      - name: super_spine_switch_template
        branch: aware
        peer: TemplateDcimPhysicalDevice
        kind: Attribute
        cardinality: one
        identifier: "fabric__super_spine_template"
        order_weight: 1100

  - name: Pod
    namespace: Topology
    branch: agnostic
    inherit_from:
      - TopologyDeployment
      - GeneratorTarget
    parent: TopologyDataCenter
    children: ""
    include_in_menu: true
    attributes:
      - name: amount_of_spines
        label: Amount of Spine switches
        branch: aware
        kind: Number
        optional: false
        default_value: 4
        order_weight: 1000
      - name: role
        kind: Dropdown
        branch: aware
        default_value: cpu
        choices:
          - name: fabric
            label: Fabric
          - name: cpu
            label: CPU
          - name: gpu
            label: GPU
          - name: storage
            label: Storage
        optional: false
        order_weight: 2000
      - name: leaf_interface_sorting_method
        branch: aware
        kind: Dropdown
        choices:
          - name: bottom_up
            color: "#869FB3"
            description: Assign interfaces starting from the lowest numbered interface.
          - name: top_down
            color: "#004E64"
            description: Assign interfaces starting from the highest numbered interface.
        default_value: bottom_up
        order_weight: 3000
      - name: spine_interface_sorting_method
        branch: aware
        kind: Dropdown
        choices:
          - name: bottom_up
            color: "#869FB3"
            description: Assign interfaces starting from the lowest numbered interface.
          - name: top_down
            color: "#004E64"
            description: Assign interfaces starting from the highest numbered interface.
        default_value: bottom_up
        order_weight: 4000
    relationships:
      - name: spine_switch_template
        peer: TemplateDcimPhysicalDevice
        branch: aware
        kind: Attribute
        cardinality: one
        identifier: "pod__spine_template"
        order_weight: 1100
      - name: loopback_pool
        peer: CoreIPAddressPool
        branch: aware
        kind: Attribute
        cardinality: one
        optional: true
        identifier: "pod__loopback_pool"
        order_weight: 6000
      - name: prefix_pool
        peer: CoreIPPrefixPool
        branch: aware
        kind: Attribute
        cardinality: one
        optional: true
        identifier: "pod__prefix_pool"
        order_weight: 7000

extensions:
  nodes:
    - kind: DcimGenericDevice
      relationships:
        - name: deployment
          peer: TopologyDeployment
          cardinality: one
          identifier: "fabric__devices"