---
version: "1.0"
generics:
  - name: ManagementServer
    namespace: Network
    description: "Generic for network management server (dns, ntp, and dhcp)."
    label: "Network Management Servers"
    human_friendly_id:
      - name__value
    display_label: "{{name__value}}"
    order_by: [name__value]
    include_in_menu: false
    attributes:
      - name: name
        kind: Text
      - name: description
        kind: Text
        optional: true
      - name: status
        kind: Dropdown
        choices:
          - name: active
            label: Active
            description: "Fully operational and currently in service."
            color: "#7fbf7f"
          - name: provisioning
            label: Provisioning
            description: "In the process of being set up and configured."
            color: "#ffff7f"
          - name: maintenance
            label: Maintenance
            description: "Undergoing routine maintenance or repairs."
            color: "#ffd27f"
          - name: drained
            label: Drained
            description: "Temporarily taken out of service."
            color: "#bfbfbf"
    relationships:
      - name: location
        peer: LocationGeneric
        optional: true
        cardinality: many
      - name: ip_addresses
        peer: IpamIPAddress
        optional: true
        cardinality: many
        kind: Component
        on_delete: cascade

  - name: Deployment
    namespace: Topology
    include_in_menu: false
    hierarchical: true
    label: Topology Deployment
    human_friendly_id:
      - name__value
    display_label: "{{name__value}}"
    attributes:
      - name: name
        kind: Text
        order_weight: 100

  # - name: OnPrem
  #   namespace: Topology
  #   include_in_menu: false
  #   attributes:
  #     - name: index
  #       kind: Number
  #       order_weight: 110
  #   relationships:
  #     - name: devices
  #       peer: DcimDevice
  #       kind: Component
  #       cardinality: many
  #       identifier: "topology__devices"
  #       order_weight: 7000
  #       on_delete: cascade

  - name: Design
    namespace: Topology
    description: "Design aspect of topology elements."
    label: "Topology Design"
    include_in_menu: false
    human_friendly_id:
      - name__value
    display_label: "{{name__value}}"
    attributes:
      - name: name
        kind: Text
        unique: true
        order_weight: 100

  - name: RackHosting
    namespace: Topology
    include_in_menu: false
    attributes:
      - name: name
        kind: Text
        order_weight: 100
    relationships:
      - name: racks
        peer: LocationRack
        kind: Generic
        cardinality: many
        identifier: "topology__racks"
        order_weight: 1200
        on_delete: cascade

  - name: DeviceHosting
    namespace: Topology
    include_in_menu: false
    attributes:
      - name: name
        kind: Text
        order_weight: 100
    relationships:
      - name: devices
        peer: DcimDevice
        kind: Generic
        cardinality: many
        identifier: "topology__devices"
        order_weight: 1200
        on_delete: cascade

nodes:
  # --------------------  Elements  --------------------
  - name: DataCenterDesign
    namespace: Topology
    description: "Design aspect for data center topology - DC-level parameters"
    label: "Data Center Design"
    inherit_from:
      - TopologyDesign
    attributes:
      - name: maximum_super_spines
        order_weight: 200
        label: "Maximum Super Spines"
        kind: Number
        default_value: 2
        optional: false
        parameters:
          min_value: 1
          max_value: 4
      - name: maximum_pods
        order_weight: 300
        label: "Maximum Pods"
        kind: Number
        parameters:
          min_value: 2
          max_value: 8
        default_value: 2
        optional: false
      - name: maximum_spines
        order_weight: 350
        label: "Maximum Spine Switches per Pod"
        kind: Number
        default_value: 2
        optional: false
        parameters:
          min_value: 2
          max_value: 4
      - name: maximum_switches
        order_weight: 400
        label: "Maximum Fabric Switches per Pod"
        kind: Number
        default_value: 16
        optional: false
      - name: naming_convention
        order_weight: 500
        label: "Device Naming Convention"
        kind: Dropdown
        default_value: standard
        optional: true
        choices:
          - name: standard
            label: Standard
            description: "Standard device naming (e.g., DC1-1-R01-L01)"
          - name: hierarchical
            label: Hierarchical
            description: "Hierarchical naming with full path"
          - name: flat
            label: Flat
            description: "Flat naming without hierarchy"
    relationships:
      - name: deployments
        peer: TopologyDataCenter
        kind: Generic
        cardinality: many
        identifier: "dc__deployments"
        order_weight: 5000

  - name: Element
    namespace: Topology
    description: "Physical aspect of topology elements."
    label: "Network Elements"
    icon: "carbon:network-3-reference"
    menu_placement: "DesignTopology"
    human_friendly_id:
      - quantity__value
      - role__value
      - template__template_name__value
    order_by: [role__value, quantity__value, template__template_name__value]
    display_label: "{{quantity__value}} x {{role__value|upper}} {{template__template_name__value}}"  # yamllint disable-line rule:line-length
    uniqueness_constraints:
      - ["template", "quantity__value", "role__value"]
    attributes:
      - name: quantity
        kind: Number
        order_weight: 1200
      - name: role
        kind: Dropdown
        optional: true
        order_weight: 1000
        choices:
          - name: core
            label: Core Router
            description: Central part of the network.
            color: "#7f7fff"
          - name: edge
            label: Edge Router
            description: Network boundary with external networks.
            color: "#bf7fbf"
          - name: cpe
            label: Customer Premise Equipment
            description: Devices located at the customer's premises.
            color: "#bf7f7f"
          - name: leaf
            label: Leaf Switch
            description: Leaf Switch part of a Pod.
            color: "#e6e6fa"
          - name: tor
            label: ToR/Level2 Switch
            description: Top of Rack  or Lavel2 leaf part of a Pod.
            color: "#e6e6fa"
          - name: border-leaf
            label: Border Leaf Switch
            description: Border Leaf providing external connectivity in a Pod.
            color: "#dda0dd"
          - name: firewall
            label: Firewall
            description: "Security boundary with external network"
            color: "#6e5abd"
          - name: load-balancer
            label: Load Balancer
            description: Load Balancer part of a Fabric.
            color: "#38e7fb"
          - name: oob
            label: OOB Switch
            description: Out of Band Switch part of a Fabric.
            color: "#e3e7fd"
          - name: console
            label: Console Server
            description: Console Server part of a Fabric.
            color: "#e9ebfd"
    relationships:
      - name: deployment
        peer: LocationRack
        optional: true
        cardinality: many
      - name: template
        label: Device Template
        peer: CoreObjectTemplate
        optional: false
        cardinality: one
        kind: Attribute
        order_weight: 1500

  - name: DataCenter
    namespace: Topology
    inherit_from:
      - CoreArtifactTarget
      - TopologyDeployment
      - GeneratorTarget
      - TopologyDeviceHosting
    label: Data Center
    include_in_menu: true
    children: TopologyPod
    uniqueness_constraints:
      - ["name__value", "index__value"]
    human_friendly_id:
      - name__value
      - index__value
    display_label: "{{ name__value}} - Fabric {{index__value}}"
    attributes:
      - name: index
        kind: Number
        order_weight: 110
      - name: status
        kind: Dropdown
        label: Status
        optional: false
        default_value: provisioning
        order_weight: 550
        choices:
          - name: active
            label: Active
            description: "Operational and in service."
            color: "#7FBF7F"
          - name: provisioning
            label: Provisioning
            description: "Being built or staged."
            color: "#FFFF7F"
          - name: maintenance
            label: Maintenance
            description: "Temporarily under maintenance."
            color: "#FFD27F"
          - name: decommissioned
            label: Decommissioned
            description: "Removed from active service."
            color: "#BFBFBF"
      - name: fully_managed
        label: Fully Managed
        kind: Boolean
        optional: false
        default_value: true
        order_weight: 600
      - name: strategy
        kind: Dropdown
        label: Strategy
        optional: false
        order_weight: 650
        choices:
          - name: ospf-ibgp
            label: ospf-ibgp
            color: "#aedcee"
          - name: ebgp-ibgp
            label: ebgp-ibgp
            color: "#7f7fff"
        default_value: ebgp-ibgp
      - name: underlay
        label: IPV6 underlay
        kind: Boolean
        optional: false
        default_value: false
        order_weight: 660
      - name: amount_of_super_spines
        label: Amount of Super Spine switches
        kind: Number
        optional: false
        default_value: 2
        order_weight: 1000
        parameters:
          min_value: 1
          max_value: 4
      # - name: capacity_summary
      #   label: Capacity Summary
      #   kind: Text
      #   read_only: true
      #   optional: true
      #   computed_attribute:
      #     kind: TransformPython
      #     transform: computed_pod_capacity_summary
      #   order_weight: 1050
      - name: fabric_interface_sorting_method
        kind: Dropdown
        label: Fabric interface assignment
        choices:
          - name: bottom_up
            label: Bottom Up
            description: Assign interfaces bottom-up.
            color: "#869FB3"
          - name: top_down
            label: Top Down
            description: Assign interfaces top-down.
            color: "#004E64"
        default_value: bottom_up
        order_weight: 1200
      - name: spine_interface_sorting_method
        kind: Dropdown
        label: Spine interface assignment
        choices:
          - name: bottom_up
            label: Bottom Up
            description: Assign interfaces bottom-up.
            color: "#869FB3"
          - name: top_down
            label: Top Down
            description: Assign interfaces top-down.
            color: "#004E64"
        default_value: bottom_up
        order_weight: 1300
    relationships:
      - name: design_pattern
        peer: TopologyDataCenterDesign
        kind: Generic
        cardinality: one
        identifier: "dc__design_pattern"
        order_weight: 500
        on_delete: no-action
      - name: super_spine_template
        peer: TemplateDcimPhysicalDevice
        kind: Attribute
        cardinality: one
        identifier: "fabric__super_spine_template"
        order_weight: 1100
        on_delete: no-action
      - name: cables
        peer: DcimCable
        kind: Generic
        cardinality: many
        identifier: "dc__cables"
        order_weight: 2000
        on_delete: cascade

  - name: Pod
    namespace: Topology
    inherit_from:
      - TopologyDeployment
      - GeneratorTarget
      - TopologyRackHosting
      - TopologyDeviceHosting
    parent: TopologyDataCenter
    children: ""
    label: Pod
    human_friendly_id:
      - parent__name__value
      - parent__index__value
      - index__value
    display_label: "{{ name__value }}"
    uniqueness_constraints:
      - ["name__value", "index__value"]
    include_in_menu: false
    attributes:
      - name: index
        kind: Number
        order_weight: 110
      - name: status
        kind: Dropdown
        label: Status
        optional: false
        default_value: provisioning
        order_weight: 140
        choices:
          - name: active
            label: Active
            description: "Operational and in service."
            color: "#7FBF7F"
          - name: provisioning
            label: Provisioning
            description: "Being built or staged."
            color: "#FFFF7F"
          - name: maintenance
            label: Maintenance
            description: "Temporarily under maintenance."
            color: "#FFD27F"
          - name: decommissioned
            label: Decommissioned
            description: "Removed from active service."
            color: "#BFBFBF"
      # - name: capacity_summary
      #   label: Capacity Summary
      #   kind: Text
      #   read_only: true
      #   optional: true
      #   computed_attribute:
      #     kind: TransformPython
      #     transform: computed_pod_capacity_summary
      #   order_weight: 550
      - name: name
        kind: Text
        computed_attribute:
          kind: Jinja2
          jinja2_template: "{{parent__name__value|upper}}-{{parent__index__value}}-POD-{{ index__value }}"  # yamllint disable-line rule:line-length
        read_only: true
        optional: false
      - name: amount_of_spines
        label: Amount of Spine switches
        kind: Number
        optional: false
        default_value: 4
        order_weight: 1000
        parameters:
          min_value: 1
          max_value: 4
      - name: number_of_rows
        order_weight: 1050
        label: "Number of Rows"
        description: "Number of rack rows in this pod (for layout planning)"
        kind: Number
        default_value: 1
        optional: true
        parameters:
          min_value: 1
          max_value: 20
      - name: maximum_leafs_per_row
        order_weight: 1110
        label: "Maximum Leafs per Row"
        description: "Maximum leaf switches per row for offset calculation"
        kind: Number
        optional: true
        parameters:
          min_value: 0
          max_value: 100
      - name: maximum_tors_per_row
        order_weight: 1120
        label: "Maximum ToRs per Row"
        description: "Maximum ToR switches per row for offset calculation"
        kind: Number
        optional: true
        parameters:
          min_value: 0
          max_value: 100
      - name: deployment_type
        kind: Dropdown
        optional: false
        order_weight: 150
        choices:
          - name: middle_rack
            label: Middle Rack
            description: Middle Rack deployment
            color: "#7f7fff"
          - name: tor
            label: Top of Rack
            description: Top of Rack deployment
            color: "#bf7fbf"
          - name: mixed
            label: ToR and Middle Rack
            description: Mix of ToR and Middle Rack deployment
            color: "#bf7f7f"
        default_value: tor
      - name: leaf_interface_sorting_method
        kind: Dropdown
        choices:
          - name: bottom_up
            color: "#869FB3"
            description: Assign interfaces bottom-up.
          - name: top_down
            color: "#004E64"
            description: Assign interfaces top-down.
        default_value: bottom_up
        order_weight: 3000
      - name: spine_interface_sorting_method
        kind: Dropdown
        choices:
          - name: bottom_up
            color: "#869FB3"
            description: Assign interfaces bottom-up.
          - name: top_down
            color: "#004E64"
            description: Assign interfaces top-down.
        default_value: bottom_up
        order_weight: 4000
      - name: usage
        kind: Text
        read_only: true
        optional: true
    relationships:
      - name: spine_template
        peer: TemplateDcimPhysicalDevice
        kind: Attribute
        cardinality: one
        identifier: "pod__spine_template"
        order_weight: 1100
        on_delete: no-action
      - name: racks
        peer: LocationRack
        kind: Generic
        cardinality: many
        identifier: "topology__racks"
        order_weight: 1200
        on_delete: cascade
      - name: loopback_pool
        peer: CoreIPAddressPool
        kind: Attribute
        cardinality: one
        optional: true
        identifier: "pod__loopback_pool"
        order_weight: 6000
        on_delete: cascade
      - name: prefix_pool
        peer: CoreIPPrefixPool
        kind: Attribute
        cardinality: one
        optional: true
        identifier: "pod__prefix_pool"
        order_weight: 7000
        on_delete: cascade

  - name: Colocation
    namespace: Topology
    inherit_from:
      - CoreArtifactTarget
      - TopologyDeployment
    uniqueness_constraints:
      - ["name__value"]
    human_friendly_id:
      - name__value
    include_in_menu: true
    display_label: "{{ name__value}}"
    label: Colocation Center
    children: TopologyColocationMetro

  - name: ColocationMetro
    namespace: Topology
    inherit_from:
      - CoreArtifactTarget
      - TopologyDeployment
    uniqueness_constraints:
      - ["name__value"]
    human_friendly_id:
      - name__value
    include_in_menu: false
    display_label: "{{ name__value}}"
    label: Colocation Center
    parent: TopologyColocation
    children: TopologyColocationAZ
    relationships:
      - name: location
        peer: LocationMetro
        cardinality: one
        kind: Attribute
        optional: true
        identifier: "colocation__metro__location"
        order_weight: 1000
        description: "Geographic location mapping for this region"

  - name: ColocationAZ
    namespace: Topology
    inherit_from:
      - TopologyDeployment
      - GeneratorTarget
      - TopologyRackHosting
      - TopologyDeviceHosting
    parent: TopologyColocationMetro
    label: Colocation Availability Zone
    children: ""
    human_friendly_id:
      - name__value
    display_label: "{{ name__value }}"
    uniqueness_constraints:
      - [name__value]
    include_in_menu: false
    attributes:
      - name: depoloyment_type
        kind: Dropdown
        label: Strategy
        optional: false
        order_weight: 650
        choices:
          - name: virtual
            label: Virtual
            color: "#aedcee"
          - name: physical
            label: Physical
            color: "#7f7fff"
          - name: hybrid
            label: Hybrid
            color: "#38e7fb"
        default_value: physical
    relationships:
      - name: devices
        peer: DcimDevice
        kind: Component
        cardinality: many
        identifier: "topology__devices"
        order_weight: 7000
        on_delete: cascade
      - name: racks
        peer: LocationRack
        kind: Generic
        cardinality: many
        identifier: "topology__racks"
        order_weight: 1200
        on_delete: cascade

  - name: Cloud
    namespace: Topology
    inherit_from:
      - TopologyDeployment
    include_in_menu: true
    children: TopologyCloudRegion
    uniqueness_constraints:
      - ["name__value"]
    human_friendly_id:
      - name__value
    display_label: "{{ name__value|upper}} CLOUD"

  - name: CloudRegion
    namespace: Topology
    inherit_from:
      - TopologyDeployment
    parent: TopologyCloud
    children: TopologyCloudAZ
    human_friendly_id:
      - region_name__value
    display_label: "{{ name__value }}"
    uniqueness_constraints:
      - ["region_name__value"]
    include_in_menu: false
    attributes:
      - name: name
        kind: Text
        computed_attribute:
          kind: Jinja2
          jinja2_template: "{{parent__name__value|upper}}-{{region_name__value|upper}}"  # yamllint disable-line rule:line-length
        read_only: true
        optional: false
      - name: region_name
        kind: Text
        label: "Region Name"
        description: "Cloud provider region identifier (e.g., us-east-1, westeurope)"  # yamllint disable-line rule:line-length
        optional: false
        order_weight: 200
      - name: status
        kind: Dropdown
        label: "Region Status"
        optional: false
        default_value: active
        order_weight: 300
        choices:
          - name: active
            label: Active
            description: "Region is active and operational"
            color: "#7FBF7F"
          - name: provisioning
            label: Provisioning
            description: "Region is being provisioned"
            color: "#FFFF7F"
          - name: maintenance
            label: Maintenance
            description: "Region is under maintenance"
            color: "#FFD27F"
          - name: constrained
            label: Constrained
            description: "Region has capacity constraints"
            color: "#F4CCCC"
          - name: deprecated
            label: Deprecated
            description: "Region is deprecated"
            color: "#BFBFBF"
    relationships:
      - name: location
        peer: LocationMetro
        cardinality: one
        kind: Attribute
        optional: true
        order_weight: 1000
        identifier: "cloud__region__location"
        description: "Geographic location mapping for this region"

  - name: CloudAZ
    namespace: Topology
    inherit_from:
      - TopologyDeployment
    parent: TopologyCloudRegion
    label: Availability Zone
    children: ""
    human_friendly_id:
      - az_name__value
    display_label: "{{ name__value }}"
    uniqueness_constraints:
      - ["az_name__value"]
    include_in_menu: false
    attributes:
      - name: name
        kind: Text
        computed_attribute:
          kind: Jinja2
          jinja2_template: "{{parent__name__value|upper}}-{{az_name__value|upper}}"  # yamllint disable-line rule:line-length
        read_only: true
        optional: false
      - name: az_name
        kind: Text
        label: "Availability Zone Name"
        description: "Cloud provider availability zone identifier"
        optional: false
        order_weight: 200
    relationships:
      - name: devices
        peer: DcimDevice
        kind: Component
        cardinality: many
        identifier: "topology__devices"
        order_weight: 7000
        on_delete: cascade

  # SaaS / third-party clouds (e.g., Webex, Zoom, Zscaler) anchored in topology
  - name: Saas
    namespace: Topology
    inherit_from:
      - TopologyDeployment
      - CoreArtifactTarget
    label: SaaS Cloud
    include_in_menu: true
    children: TopologySaasRegion
    uniqueness_constraints:
      - ["name__value"]
    human_friendly_id:
      - name__value
    display_label: "{{ name__value|upper}} SAAS"
    attributes:
      - name: provider
        kind: Dropdown
        label: Provider
        optional: false
        default_value: other
        order_weight: 200
        choices:
          - name: cisco
            label: Cisco
            description: Cisco SaaS (Webex, Umbrella)
            color: "#1BA0D7"
          - name: zoom
            label: Zoom
            description: Zoom conferencing
            color: "#2D8CFF"
          - name: zscaler
            label: Zscaler
            description: Zscaler cloud security
            color: "#0066CC"
          - name: palo_alto
            label: Palo Alto
            description: Palo Alto (Prisma, other)
            color: "#FA582D"
          - name: microsoft
            label: Microsoft
            description: Microsoft cloud apps
            color: "#6264A7"
          - name: salesforce
            label: Salesforce
            description: Salesforce cloud services
            color: "#00A1E0"
          - name: other
            label: Other
            description: Other provider
            color: "#95A5A6"
      - name: service_type
        kind: Dropdown
        label: Service Type
        optional: false
        default_value: other
        order_weight: 300
        choices:
          - name: sase
            label: SASE / SWG
            color: "#3498DB"
          - name: conferencing
            label: Conferencing
            color: "#2ECC71"
          - name: crm
            label: CRM
            color: "#9B59B6"
          - name: storage
            label: Storage
            color: "#F39C12"
          - name: api
            label: API Integration
            color: "#16A085"
          - name: other
            label: Other
            color: "#95A5A6"
      - name: status
        kind: Dropdown
        label: Status
        optional: false
        default_value: active
        order_weight: 400
        choices:
          - name: active
            label: Active
            color: "#7FBF7F"
          - name: provisioning
            label: Provisioning
            color: "#FFFF7F"
          - name: maintenance
            label: Maintenance
            color: "#FFD27F"
          - name: decommissioned
            label: Decommissioned
            color: "#BFBFBF"
      - name: description
        kind: Text
        label: Description
        optional: true
        order_weight: 500

  - name: SaasRegion
    namespace: Topology
    inherit_from:
      - TopologyDeployment
    parent: TopologySaas
    children: ""
    human_friendly_id:
      - region_name__value
    display_label: "{{ name__value }}"
    uniqueness_constraints:
      - ["region_name__value"]
    include_in_menu: false
    attributes:
      - name: name
        kind: Text
        computed_attribute:
          kind: Jinja2
          jinja2_template: "{{parent__name__value|upper}}-{{region_name__value|upper}}"  # yamllint disable-line rule:line-length
        read_only: true
        optional: false
      - name: region_name
        kind: Text
        label: "Region Name"
        description: "Provider region identifier"
        optional: false
        order_weight: 200
      - name: status
        kind: Dropdown
        label: "Region Status"
        optional: false
        default_value: active
        order_weight: 300
        choices:
          - name: active
            label: Active
            description: "Region is active and operational"
            color: "#7FBF7F"
          - name: provisioning
            label: Provisioning
            description: "Region is being provisioned"
            color: "#FFFF7F"
          - name: maintenance
            label: Maintenance
            description: "Region is under maintenance"
            color: "#FFD27F"
          - name: constrained
            label: Constrained
            description: "Region has capacity constraints"
            color: "#F4CCCC"
          - name: deprecated
            label: Deprecated
            description: "Region is deprecated"
            color: "#BFBFBF"
    relationships:
      - name: location
        peer: LocationMetro
        cardinality: one
        kind: Attribute
        optional: true
        order_weight: 1000
        identifier: "saas__region__location"
        description: "Geographic mapping for provider region"

extensions:
  nodes:
    - kind: DcimDevice
      relationships:
        - name: deployment
          peer: TopologyDeviceHosting
          cardinality: one
          identifier: "topology__devices"
    - kind: DcimCable
      relationships:
        - name: deployment
          peer: TopologyDataCenter
          cardinality: one
          optional: true
          kind: Attribute
          order_weight: 2000
          identifier: "dc__cables"
    - kind: LocationRack
      relationships:
        - name: deployment
          peer: TopologyRackHosting
          cardinality: one
          optional: true
          kind: Attribute
          order_weight: 2000
          identifier: "topology__racks"
