---
# yaml-language-server: $schema=https://schema.infrahub.app/infrahub/schema/latest.json
version: "1.0"

nodes:
  - name: Region
    namespace: Location
    label: Region
    parent: ""
    inherit_from:
      - LocationGeneric
    menu_placement: LocationGeneric
    include_in_menu: false
    display_labels:
      - name__value
    children: LocationCountry
    icon: "carbon:cics-region-target"

  - name: Country
    namespace: Location
    label: Country
    inherit_from:
      - LocationGeneric
    menu_placement: LocationGeneric
    include_in_menu: false
    display_labels:
      - name__value
    parent: "LocationRegion"
    children: LocationMetro
    icon: gis:search-country
    attributes:
      - name: timezone
        kind: Text
        optional: true
        order_weight: 1300
  - name: Metro
    namespace: Location
    label: Metro
    branch: agnostic
    inherit_from:
      - LocationGeneric
    menu_placement: LocationGeneric
    include_in_menu: false
    display_labels:
      - name__value
    parent: LocationCountry
    children: LocationBuilding
    icon: healthicons:city
  - name: Building
    namespace: Location
    branch: agnostic
    inherit_from:
      - LocationGeneric
    menu_placement: "LocationGeneric"
    include_in_menu: false
    label: Building
    display_labels:
      - name__value
    parent: "LocationMetro"
    children: "LocationSuite"
    icon: "ri:building-line"
    attributes:
      - name: facility_id
        kind: Text
        unique: false
        optional: true
        order_weight: 1100
      - name: physical_address
        kind: Text
        unique: false
        optional: true
        order_weight: 1500
      - name: is_cloud
        kind: Boolean
        optional: false
        default_value: false
        order_weight: 1600
    relationships:
      - name: owner
        peer: OrganizationGeneric
        optional: true
        branch: aware
        cardinality: one
  - name: Suite
    namespace: Location
    inherit_from:
      - "LocationGeneric"
    include_in_menu: false
    menu_placement: "LocationGeneric"
    label: Suite
    branch: agnostic
    display_labels:
      - name__value
    parent: "LocationBuilding"
    children: "LocationRack"
    icon: "game-icons:cage"
    attributes:
      - name: facility_id
        kind: Text
        unique: false
        optional: true
        order_weight: 1100
    relationships:
      - name: owner
        peer: OrganizationGeneric
        optional: true
        cardinality: one
  - name: Rack
    namespace: Location
    inherit_from:
      - LocationGeneric
      - GeneratorTarget
    include_in_menu: false
    menu_placement: "LocationGeneric"
    label: Rack
    branch: agnostic
    display_labels:
      - name__value
    human_friendly_id:
      - shortname__value
    parent: "LocationSuite"
    children: ""
    icon: "clarity:rack-server-line"
    attributes:
      - name: index
        kind: Number
        branch: agnostic
        optional: false
      - name: rack_type
        kind: Dropdown
        branch: aware
        choices:
          - name: compute
            label: Compute
          - name: storage
            label: Storage
          - name: tor
            label: Top-of-Rack
          - name: fabric
            label: Fabric
        default_value: compute
      - name: facility_id
        # branch: aware
        kind: Text
        unique: false
        optional: true
        order_weight: 1100
    relationships:
      - name: owner
        peer: OrganizationGeneric
        branch: aware
        optional: true
        cardinality: one
      - name: fabric_templates
        peer: TopologyElement
        branch: aware
        optional: true
        cardinality: many
      - name: pod
        peer: TopologyPod
        branch: aware
        kind: Attribute
        cardinality: one
        optional: true
        identifier: "rack__pod"
      - name: devices
        peer: DcimPhysicalDevice
        branch: aware
        optional: true
        cardinality: many
        kind: Generic
        identifier: "device_rack"
extensions:
  nodes:
    - kind: OrganizationProvider
      relationships:
        - name: location
          peer: LocationBuilding
          cardinality: many
          optional: true
    - kind: TopologyDeployment
      relationships:
        - name: racks
          peer: LocationRack
          branch: aware
          cardinality: many
          kind: Generic
          identifier: "rack__pod"
    - kind: DcimPhysicalDevice
      relationships:
        - name: rack
          peer: LocationRack
          branch: aware
          cardinality: one
          kind: Attribute
          optional: true
          identifier: "device_rack"