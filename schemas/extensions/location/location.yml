---
version: "1.0"

nodes:
  - name: Region
    namespace: Location
    label: Region
    inherit_from:
      - LocationGeneric
    uniqueness_constraints:
      - ["name__value"]
    menu_placement: LocationGeneric
    include_in_menu: false
    display_label: "{{name__value}}"
    children: LocationCountry
    icon: "carbon:cics-region-target"
  - name: Country
    namespace: Location
    label: Country
    inherit_from:
      - LocationGeneric
    menu_placement: LocationGeneric
    uniqueness_constraints:
      - ["name__value"]
    include_in_menu: false
    display_label: "{{name__value}}"
    parent: "LocationRegion"
    children: LocationMetro
    icon: gis:search-country
    attributes:
      - name: timezone
        kind: Text
        optional: true
        order_weight: 1300
  - name: Metro
    namespace: Location
    label: Metro
    inherit_from:
      - LocationGeneric
    menu_placement: LocationGeneric
    include_in_menu: false
    display_label: "{{name__value}}"
    parent: LocationCountry
    children: LocationBuilding
    icon: healthicons:city
  - name: Building
    namespace: Location
    inherit_from:
      - LocationGeneric
    menu_placement: "LocationGeneric"
    include_in_menu: false
    label: Building
    display_label: "{{name__value}}"
    parent: "LocationMetro"
    children: "LocationSuite"
    icon: "ri:building-line"
    attributes:
      - name: facility_id
        kind: Text
        unique: false
        optional: true
        order_weight: 1100
      - name: physical_address
        kind: Text
        unique: false
        optional: true
        order_weight: 1500
      - name: is_cloud
        kind: Boolean
        optional: false
        default_value: false
        order_weight: 1600
    relationships:
      - name: owner
        peer: OrganizationGeneric
        optional: true
        cardinality: one
  - name: Suite
    namespace: Location
    inherit_from:
      - "LocationGeneric"
    include_in_menu: false
    menu_placement: "LocationGeneric"
    label: Suite
    parent: LocationBuilding
    children: "LocationRack"
    icon: "game-icons:cage"
    attributes:
      - name: name
        kind: Text
        computed_attribute:
          kind: Jinja2
          jinja2_template: "{{parent__name__value}}-{{suite_name__value}}"
        read_only: true
        optional: false
      - name: suite_name
        kind: Text
        optional: false
    relationships:
      - name: owner
        peer: OrganizationGeneric
        optional: true
        cardinality: one
  - name: Rack
    namespace: Location
    inherit_from:
      - LocationGeneric
      - GeneratorTarget
    include_in_menu: false
    menu_placement: "LocationGeneric"
    parent: "LocationSuite"
    children: ""
    uniqueness_constraints:
      - ["name__value"]
    label: Rack
    icon: "clarity:rack-server-line"
    display_label: "{{ name__value }}"
    attributes:
      - name: name
        kind: Text
        computed_attribute:
          kind: Jinja2
          jinja2_template: "{{parent__name__value|upper}}-R{{row_index__value}}-{{index__value}}"  # yamllint disable-line rule:line-length
        read_only: true
        optional: false
      - name: index
        kind: Number
        order_weight: 120
      - name: row_index
        kind: Number
        order_weight: 121
      - name: rack_type
        kind: Dropdown
        choices:
          - name: compute
            label: Compute
          - name: storage
            label: Storage
          - name: tor
            label: Top-of-Rack
          - name: network
            label: Network
        default_value: compute
      - name: facility_id
        kind: Text
        unique: false
        optional: true
        order_weight: 1100
    relationships:
      - name: owner
        peer: OrganizationGeneric
        optional: true
        cardinality: one
      - name: fabric_templates
        peer: TopologyElement
        label: Network Elements
        optional: true
        cardinality: many
        kind: Attribute
      - name: pod
        peer: TopologyRackHosting
        kind: Attribute
        cardinality: one
        identifier: "rack__pod"
        optional: true
      - name: devices
        peer: DcimPhysicalDevice
        label: Devices in Rack
        optional: true
        cardinality: many
        kind: Generic
        identifier: "device_rack"
extensions:
  nodes:
    - kind: OrganizationProvider
      relationships:
        - name: location
          peer: LocationBuilding
          cardinality: many
          optional: true

    - kind: DcimPhysicalDevice
      relationships:
        - name: rack
          peer: LocationRack
          cardinality: one
          kind: Attribute
          optional: true
          identifier: "device_rack"
