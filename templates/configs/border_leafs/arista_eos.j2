!\n! Arista EOS Border Leaf Configuration\n! Device: {{ hostname }}\n! Generated for Arista EOS\n!\n\nhostname {{ hostname }}\n\n! Configure spanning tree mode\nspanning-tree mode mstp\n\n! Configure VLAN 1\nno spanning-tree vlan-id 4094\n\n{#- VLAN Configuration -#}\n{% for vlan in vlans %}\nvlan {{ vlan.vlan_id }}\n   name {{ vlan.name or 'VLAN_' + vlan.vlan_id|string }}\n\n{% endfor %}\n\n{#- All Physical Interfaces (sorted) -#}\n{% for interface in interfaces %}\ninterface {{ interface.name }}\n{% if interface.description %}\n   description {{ interface.description }}\n{% else %}\n   description {{ interface.role|title }} interface\n{% endif %}\n{% if interface.ip_addresses %}\n{% for ip in interface.ip_addresses %}\n   ip address {{ ip }}\n{% endfor %}\n{% endif %}\n{% if interface.vlans %}\n{% if interface.vlans|length == 1 %}\n   switchport access vlan {{ interface.vlans[0] }}\n{% else %}\n   switchport trunk allowed vlan {{ interface.vlans|join(',') }}\n{% endif %}\n{% endif %}\n{% if interface.get('ospf') %}\n   ip ospf area {{ interface.ospf.area }}\n{% endif %}\n\n{% endfor %}\n\n! Configure OSPF\n{% for ospf_config in ospf %}\nrouter ospf {{ ospf_config.process_id or 1 }}\n   router-id {{ ospf_config.router_id.split('/')[0] }}\n   passive-interface default\n{% for interface in interfaces %}\n{% if interface.get('ospf') and interface.ospf.area == ospf_config.area %}\n   no passive-interface {{ interface.name }}\n{% endif %}\n{% endfor %}\n   max-lsa 12000\n\n{% endfor %}\n\n! Configure BGP\n{% for bgp_config in bgp %}\nrouter bgp {{ bgp_config.local_as.asn }}\n   router-id {{ bgp_config.router_id.address.split('/')[0] }}\n   no bgp default ipv4-unicast\n   distance bgp 20 200 200\n   maximum-paths 4 ecmp 64\n{% for session in bgp_config.sessions %}\n   neighbor {{ session.remote_ip.address.split('/')[0] }} remote-as {{ session.remote_as.asn }}\n   neighbor {{ session.remote_ip.address.split('/')[0] }} update-source Loopback0\n   neighbor {{ session.remote_ip.address.split('/')[0] }} description {{ session.remote_ip.address.split('/')[0] }}\n   neighbor {{ session.remote_ip.address.split('/')[0] }} send-community extended\n   neighbor {{ session.remote_ip.address.split('/')[0] }} maximum-routes 0\n{% endfor %}\n   address-family ipv4\n      redistribute connected route-map RM-CONN-2-BGP\n{% for session in bgp_config.sessions %}\n      neighbor {{ session.remote_ip.address.split('/')[0] }} activate\n{% endfor %}\n   address-family evpn\n{% for session in bgp_config.sessions %}\n      neighbor {{ session.remote_ip.address.split('/')[0] }} activate\n{% endfor %}\n\n{% endfor %}\n\n! Configure route-maps\nroute-map RM-CONN-2-BGP permit 10\n   match interface Loopback0\n\n! End of configuration\n