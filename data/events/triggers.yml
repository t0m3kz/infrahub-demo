---
apiVersion: infrahub.app/v1
kind: Object
spec:
  kind: CoreGeneratorAction
  data:
    - name: run-pod-generator
      generator: generate-pod
    - name: run-rack-generator
      generator: generate-rack

---
apiVersion: infrahub.app/v1
kind: Object
spec:
  kind: CoreNodeTriggerRule
  data:

    - name: trigger-pod-generator-update-checksum
      branch_scope: "other_branches"
      node_kind: TopologyPod
      mutation_action: "updated"
      action: run-pod-generator
      matches:
        kind: CoreNodeTriggerAttributeMatch
        data:
          - attribute_name: checksum
            value_match: any

    - name: trigger-pod-generator-update-index
      branch_scope: "other_branches"
      node_kind: TopologyPod
      mutation_action: "updated"
      action: run-pod-generator
      matches:
        kind: CoreNodeTriggerAttributeMatch
        data:
          - attribute_name: index
            value_match: any

    - name: trigger-pod-generator-update-amount-of-spines
      branch_scope: "other_branches"
      node_kind: TopologyPod
      mutation_action: "updated"
      action: run-pod-generator
      matches:
        kind: CoreNodeTriggerAttributeMatch
        data:
          - attribute_name: amount_of_spines
            value_match: any

    - name: trigger-pod-generator-update-role
      branch_scope: "other_branches"
      node_kind: TopologyPod
      mutation_action: "updated"
      action: run-pod-generator
      matches:
        kind: CoreNodeTriggerAttributeMatch
        data:
          - attribute_name: role
            value_match: any

    # - name: trigger-rack-generator-update-checksum
    #   branch_scope: "other_branches"
    #   node_kind: TopologyRack
    #   mutation_action: "updated"
    #   action: run-rack-generator
    #   matches:
    #     kind: CoreNodeTriggerAttributeMatch
    #     data:
    #       - attribute_name: checksum
    #         value_match: any

    # - name: trigger-rack-generator-update-index
    #   branch_scope: "other_branches"
    #   node_kind: TopologyRack
    #   mutation_action: "updated"
    #   action: run-rack-generator
    #   matches:
    #     kind: CoreNodeTriggerAttributeMatch
    #     data:
    #       - attribute_name: index
    #         value_match: any

    # - name: trigger-rack-generator-update-rack-type
    #   branch_scope: "other_branches"
    #   node_kind: TopologyRack
    #   mutation_action: "updated"
    #   action: run-rack-generator
    #   matches:
    #     kind: CoreNodeTriggerAttributeMatch
    #     data:
    #       - attribute_name: rack_type
    #         value_match: any
