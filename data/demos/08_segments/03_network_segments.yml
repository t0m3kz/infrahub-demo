---
# Network Segments Configuration for DC1
# This file demonstrates how to configure VLANs
# for VXLAN L2 and L3 VNI auto-generation
#
# VXLAN Convention:
#   L2 VNI = 10000 + VLAN_ID (e.g., VLAN 100 → VNI 10100)
#   L3 VNI = 50000 + VRF_ID (auto-generated for VRF segments)
#
# Segment Types:
#   - l2_only: Pure L2 segment (generates L2 VNI only)
#   - l3_gateway: L2 segment with L3 gateway (generates L2 VNI)
#   - l3_vrf: VRF segment (generates L3 VNI for microsegmentation)

apiVersion: infrahub.app/v1
kind: Object
spec:
  kind: ServiceNetworkSegment
  data:
    # =============================================================================
    # L2-Only Segments (Pure Layer 2, no gateway)
    # =============================================================================
    - customer_name: "Guest WiFi"
      environment: production
      segment_type: l2_only
      tenant_isolation: shared_controlled
      vlan_id: 100
      deployment: DC1
      owner: Acme Corporation
      description: "Guest wireless network - L2 only"
      member_of_groups:
        - network_segments

    - customer_name: "IoT Devices"
      environment: production
      segment_type: l2_only
      tenant_isolation: customer_dedicated
      vlan_id: 110
      deployment: DC1
      owner: Acme Corporation
      description: "IoT device network - isolated L2"
      member_of_groups:
        - network_segments

    # =============================================================================
    # L3 Gateway Segments (L2 with Layer 3 gateway)
    # =============================================================================
    - customer_name: "Corporate LAN"
      environment: production
      segment_type: l3_gateway
      tenant_isolation: customer_dedicated
      vlan_id: 200
      deployment: DC1
      owner: Acme Corporation
      description: "Corporate office network with L3 gateway"
      member_of_groups:
        - network_segments

    - customer_name: "Development"
      environment: no-production
      segment_type: l3_gateway
      tenant_isolation: customer_dedicated
      vlan_id: 210
      deployment: DC1
      owner: Acme Corporation
      description: "Development team network"
      member_of_groups:
        - network_segments

    - customer_name: "QA Testing"
      environment: no-production
      segment_type: l3_gateway
      tenant_isolation: customer_dedicated
      vlan_id: 220
      deployment: DC1
      owner: Acme Corporation
      description: "QA and testing environment"
      member_of_groups:
        - network_segments

    # =============================================================================
    # L3 VRF Segments (Microsegmentation with dedicated VRF)
    # =============================================================================
    # VRF segments enable tenant with isolation L3 VNI (VNI = 50000 + VRF_ID)
    # Each VRF gets its own routing table and BGP EVPN instance

    - customer_name: "Tenant-Alpha"
      environment: production
      segment_type: l3_vrf
      tenant_isolation: customer_dedicated
      vlan_id: 300
      external_routing: true
      deployment: DC1
      owner: Tenant Alpha Corp
      description: "Tenant Alpha dedicated VRF - full isolation"
      member_of_groups:
        - network_segments

    - customer_name: "Tenant-Beta"
      environment: production
      segment_type: l3_vrf
      tenant_isolation: customer_dedicated
      vlan_id: 310
      external_routing: true
      deployment: DC1
      owner: Tenant Beta Inc
      description: "Tenant Beta dedicated VRF - full isolation"
      member_of_groups:
        - network_segments

    - customer_name: "Tenant-Gamma"
      environment: production
      segment_type: l3_vrf
      tenant_isolation: customer_dedicated
      vlan_id: 320
      external_routing: false
      deployment: DC1
      owner: Tenant Gamma LLC
      description: "Tenant Gamma VRF - internal routing only"
      member_of_groups:
        - network_segments

    # =============================================================================
    # Multi-Environment Segments (Production + Non-Production)
    # =============================================================================
    - customer_name: "Database Servers"
      environment: production
      segment_type: l3_gateway
      tenant_isolation: customer_dedicated
      vlan_id: 400
      deployment: DC1
      owner: Acme Corporation
      description: "Production database server network"
      member_of_groups:
        - network_segments

    - customer_name: "Database Servers"
      environment: no-production
      segment_type: l3_gateway
      tenant_isolation: customer_dedicated
      vlan_id: 410
      deployment: DC1
      owner: Acme Corporation
      description: "Non-production database server network"
      member_of_groups:
        - network_segments

    - customer_name: "Web Servers"
      environment: production
      segment_type: l3_gateway
      tenant_isolation: public_shared
      vlan_id: 500
      deployment: DC1
      owner: Acme Corporation
      description: "Production web server DMZ"
      member_of_groups:
        - network_segments

    - customer_name: "App Servers"
      environment: production
      segment_type: l3_gateway
      tenant_isolation: customer_dedicated
      vlan_id: 510
      deployment: DC1
      owner: Acme Corporation
      description: "Production application servers"
      member_of_groups:
        - network_segments

    # =============================================================================
    # Storage and Backup Segments
    # =============================================================================
    - customer_name: "Storage Network"
      environment: production
      segment_type: l2_only
      tenant_isolation: customer_dedicated
      vlan_id: 600
      deployment: DC1
      owner: Acme Corporation
      description: "Dedicated storage network (iSCSI/NFS)"
      member_of_groups:
        - network_segments

    - customer_name: "Backup Network"
      environment: production
      segment_type: l2_only
      tenant_isolation: customer_dedicated
      vlan_id: 610
      deployment: DC1
      owner: Acme Corporation
      description: "Backup and replication traffic"
      member_of_groups:
        - network_segments

---
# Expected VXLAN VNI Mappings (auto-generated by transforms):
#
# L2 VNI Mappings:
#   VLAN 100 → VNI 10100 (Guest WiFi)
#   VLAN 110 → VNI 10110 (IoT Devices)
#   VLAN 200 → VNI 10200 (Corporate LAN)
#   VLAN 210 → VNI 10210 (Development)
#   VLAN 220 → VNI 10220 (QA Testing)
#   VLAN 400 → VNI 10400 (Database Prod)
#   VLAN 410 → VNI 10410 (Database NonProd)
#   VLAN 500 → VNI 10500 (Web Servers)
#   VLAN 510 → VNI 10510 (App Servers)
#   VLAN 600 → VNI 10600 (Storage)
#   VLAN 610 → VNI 10610 (Backup)
#
# L3 VNI Mappings (VRF microsegmentation):
#   VLAN 300 → L3 VNI 50001 (Tenant-Alpha VRF)
#   VLAN 310 → L3 VNI 50002 (Tenant-Beta VRF)
#   VLAN 320 → L3 VNI 50003 (Tenant-Gamma VRF)
#
# EVPN Route Distinguishers (auto-generated):
#   RD = {router_id}:{vni}
#   Example: 1.1.1.1:10100 for VLAN 100
#
# EVPN Route Targets (auto-generated):
#   RT = {as}:{vni}
#   Example: 65000:10100 for VLAN 100
