fragment TemplateDeviceFields on TemplateDcimPhysicalDevice {
  platform {
    node {
      id
      name {
        value
      }
    }
  }
  device_type {
    node {
      id
    }
  }
  interfaces(role__value: "uplink") {
    edges {
      node {
        name {
          value
        }
        role {
          value
        }
      }
    }
  }
}

fragment FabricTemplateFields on TopologyElement {
  name {
    value
  }
  role {
    value
  }
  quantity {
    value
  }
  template {
    node {
      id
      ...TemplateDeviceFields
    }
  }
}

fragment PodFields on TopologyPod {
  id
  name {
    value
  }
  index {
    value
  }
  parent {
    node {
      ... on TopologyDataCenter {
        id
        name {
          value
        }
        index {
          value
        }
        design_pattern {
          node {
            naming_convention {
              value
            }
            maximum_leafs {
              value
            }
            maximum_tors {
              value
            }
          }
        }
      }
    }
  }
  amount_of_spines {
    value
  }
  maximum_leafs_per_row {
    value
  }
  maximum_tors_per_row {
    value
  }
  leaf_interface_sorting_method {
    value
  }
  spine_interface_sorting_method {
    value
  }
  loopback_pool {
    node {
      id
    }
  }
  prefix_pool {
    node {
      id
    }
  }
  deployment_type {
    value
  }
  spine_template {
    node {
      id
      interfaces(role__value: "leaf") {
        edges {
          node {
            name {
              value
            }
          }
        }
      }
    }
  }
}

query RackGenerator($name: String!) {
  LocationRack(name__value: $name) {
    edges {
      node {
        id
        name {
          value
        }
        checksum {
          value
        }
        index {
          value
        }
        rack_type {
          value
        }
        row_index {
          value
        }
        leafs: fabric_templates(role__value: "leaf") {
          edges {
            node {
              ...FabricTemplateFields
            }
          }
        }
        tors: fabric_templates(role__value: "tor") {
          edges {
            node {
              ...FabricTemplateFields
            }
          }
        }
        pod {
          node {
            ...PodFields
          }
        }
      }
    }
  }
}
